 ; Simple test showing segment selectors for COM files

  bits  16

  org   0x100

  lea   dx,[msg1]
  mov   ah,9
  int   0x21
  mov   ax,cs
  call  printhex

  lea   dx,[msg2]
  mov   ah,9
  int   0x21
  mov   ax,ds
  call  printhex

  lea   dx,[msg3]
  mov   ah,9
  int   0x21
  mov   ax,es
  call  printhex

  lea   dx,[msg4]
  mov   ah,9
  int   0x21
  mov   ax,ss
  call  printhex

  lea   dx,[msg5]
  mov   ah,9
  int   0x21

  mov   ax,0x4c00
  int   0x21

printhex:
  mov   cl,12
.loop:
  push  ax
  mov   bx,ax
  shr   bx,cl
  and   bx,0x0f
  mov   al,[bx+hextbl]
  mov   [digit],al
  lea   dx,[digit]
  mov   ah,9
  int   0x21
  pop   ax
  sub   cl,4
  jnl   .loop
  ret

msg1: db    'cs=$'
msg2: db    ', ds=$'
msg3: db    ', es=$'
msg4: db    ' ss=$'
msg5: db    `\r\n$`
digit: db   '0$'
hextbl: db  '0123456789ABCDEF'

